<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Why I Rewrote std::shared_ptr</title>

  <meta name="description" content="Slides about a C++ talk for a custom std::shared_ptr implementation: xmem">
  <meta name="author" content="Borislav Stanimirov">

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="stylesheet" href="../lib/reveal.js-3.8.0/css/reveal.min.css" />
  <link rel="stylesheet" href="../lib/reveal.js-3.8.0/css/theme/simple.min.css" id="theme" />
  <link rel="stylesheet" href="../lib/slides.css" />

  <!-- For syntax highlighting -->
  <link rel="stylesheet" href="/third_party/highlight-new/styles/github-gist.css">

  <!-- Slides-specific styles -->
  <link rel="stylesheet" href="custom.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ?
      'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/css/print/pdf.min.css' :
      'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/css/print/paper.min.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>

  <!--[if lt IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>

<body>

  <div class="reveal">
    <div class="slides">
      <section class="title">
        <h1>Why I Rewrote <code>std::shared_ptr</code></h1>
        <br/>
        <p>
          <a href="http://ibob.bg">Borislav Stanimirov</a> / <a href="https://twitter.com/stanimirovb">@stanimirovb</a>
        </p>
      </section>

      <section class="slide">
        <h3>Hello, World</h3>
        <br/>
        <pre><code class="cpp hljs" data-noescape>
  #include &lt;iostream&gt;

  int main()
  {
      std::cout &lt;&lt; "Hi, I'm Borislav!\n";
      std::cout &lt;&lt; "These slides are here: <span class="fragment hl-code">https://is.gd/xsptr</span>\n";
      return 0;
  }
        </code></pre>
      </section>

      <section class="slide">
        <h3>Borislav Stanimirov</h3>
        <br/>
        <ul>
          <li>I mostly write <span class="fancy">C++</span></li>
          <li>2006-2018: <span class="fancy">game development</span></li>
          <li>From 2019 on: <span class="fancy">medical software</span></li>
          <li><span class="fancy">Open source</span> software</li>
          <li><a href="https://github.com/iboB" target="_blank">github.com/iboB</a></li>
        </ul>
      </section>

      <section>
        <a href="https://viewray.com" target="_blank"><img class="diagram" src="../beyond-vec/ViewRay_Logo.png"/></a>
        <br><br>
        <p class="fragment">A blog post of what we do: <a href="https://ibob.bg/blog/2022/01/25/what-we-do-at-viewray/" target="_blank">ibob.bg/blog</a></p>
      </section>

      <section class="slide">
        <h3>This talk</h3>
        <br/>
        <ul>
          <li>What are <span class="fancy">shared pointers</span> and <span class="fancy">weak pointers</span></li>
          <li>Specifically <code class="cinline">std::shared_ptr</code> and <code class="cinline">std::weak_ptr</code></li>
          <li>Minor things that <span class="fancy">I don't like</span> about them</li>
          <li>Potential issues with them: <span class="fancy">shared pointer leaks</span></li>
          <li>Why would anyone rewrite the standard ones. <span class="fancy">Pros and cons</span></li>
          <li><span class="fancy">&quot;Exotic&quot;</span> shared pointers</li>
        </ul>
      </section>

      <section class="slide">
        <h3>NOT This talk</h3>
        <br/>
        <ul>
          <li>Use cases for shared pointers</li>
          <li>General shared pointer criticism</li>
          <li>Responding to general shared pointer criticism</li>
          <li>A guide to rewriting <code class="cinline">std::shared_ptr</code></li>
        </ul>
      </section>

      <section>
        <h2>A Crash Course in Shared Pointers</h2>
      </section>

      <section class="slide">
        <h3>Smart pointers</h3>
        <br/>
        <ul>
          <li>Free memory as needed</li>
          <li>Smart pointers in C++:</li>
          <ul>
            <li><code class="cinline">std::unique_ptr</code></li>
            <li><code class="cinline">std::shared_ptr</code> <span class="fancy">&#9733;</span></li>
            <li>but also <code class="cinline">std::vector</code></li>
            <li>to an extent, every container</li>
          </ul>
          <li><span class="fancy">Now you have no excuse to write <code class="cinline">delete</code></span></li>
        </ul>
      </section>

      <section class="slide">
        <h3><code>std::shared_ptr</code></h3>
        <br/>
        <p>Shared ownership through reference counting</p>
        <pre><code class="cpp hljs" data-noescape>
  auto a = std::make_shared&lt;person&gt;(&quot;Alice&quot;); <span class="zfragment">// Allocate one person</span>
                                              <span class="zfragment">// Ref count of Alice is 1</span>
  auto b = a; <span class="zfragment">// a and b point to Alice. Ref count is 2</span>
  a.reset(); <span class="zfragment">// a doesn't point to Alice, but b still does. Ref count is 1</span>
  b.reset(); <span class="zfragment">// b doesn't point to Alice. Ref count is 0. Alice is deleted</span>
        </code></pre>
        <p>Alice started her lifetime with <code class="cinline">a</code> and ended it with <code class="cinline">b</code></p>
      </section>

      <section class="slide">

      </section>

      <section>
        <h1>End</h1>
        <h2>Questions?</h2>
        <p>Borislav Stanimirov / <a href="https://ibob.bg">ibob.bg</a> / <a href="https://twitter.com/stanimirovb">@stanimirovb</a></p>
        <p>
          <small>
          These slides: <a href="https://ibob.bg/slides/xmem-shared-ptr/">ibob.bg/slides/xmem-shared-ptr/</a>
          </small>
          <br />
          <small>
          xmem: <a href="https://github.com/iboB/xmem/">github.com/iboB/xmem</a>
          </small>
          <br />
          <small>
          Slides license <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons By 4.0</a><br /><a rel="license" href="https://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
          </small>
        </p>
      </section>

    </div>
  </div>

  <script src="../lib/reveal.js-3.8.0/js/reveal.min.js"></script>
  <script src="../lib/slides.js"></script>

  <script>
    Reveal.initialize({
      width: 1280,
      height: 720,

      controls: true,
      progress: true,
      history: true,
      center: true,

      transition: 'none', // none/fade/slide/convex/concave/zoom

      autoPlayMedia: false,
      preloadIframes: false,

      // Optional libraries used to extend on reveal.js
      dependencies: [
        //{ src: 'markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        //{ src: 'markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
        { src: 'highlight/highlight.min.js', async: true, callback: function() {
          hljs.initHighlightingOnLoad();
        } },
        //{ src: 'zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
        //{ src: 'notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
      ].map(p => { p.src = '../lib/reveal.js-3.8.0/plugin/' + p.src; return p; })
    });

    slides.footerSetup('is.gd/xsptr', '2022');
  </script>

</body>
</html>
